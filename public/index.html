<!DOCTYPE html>
<html>
<head>
  <title>坦克大战 Battle City</title>
  <style>
    body { 
      margin: 0; 
      overflow: hidden; 
      background: #000; 
      font-family: Arial, sans-serif;
    }
    canvas { display: block; }
    #ui {
      position: absolute;
      top: 0;
      right: 0;
      width: 15%;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      font-size: 14px;
    }
    #instructions {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="ui">
    <h3>排行榜</h3>
    <div id="leaderboard">等待玩家加入...</div>
  </div>
  
  <div id="instructions">
    <p>操作说明:</p>
    <p>方向键: 移动坦克</p>
    <p>空格键: 发射炮弹</p>
    <p>打开多个窗口可测试多人游戏</p>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let players = {};
    let canvas = document.getElementById('gameCanvas');
    let ctx = canvas.getContext('2d');

    // 设置画布大小
    function resizeCanvas() {
      canvas.width = window.innerWidth * 0.85;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // 绘制玩家
    function drawPlayers() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      for (let id in players) {
        const player = players[id];
        ctx.fillStyle = 'white';
        ctx.font = '16px Arial';
        ctx.fillText(player.name, player.x - 20, player.y - 25);
        
        // 绘制坦克（简单矩形）
        ctx.fillStyle = 'green';
        ctx.fillRect(player.x - 10, player.y - 10, 20, 20);
      }
    }

    socket.on('playerUpdate', (data) => {
      players = data;
      drawPlayers();
    });

    socket.on('removePlayer', (id) => {
      delete players[id];
      drawPlayers();
    });

    document.addEventListener('keydown', (e) => {
      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
        e.preventDefault();
        switch(e.key) {
          case 'ArrowUp': socket.emit('move', 'up'); break;
          case 'ArrowDown': socket.emit('move', 'down'); break;
          case 'ArrowLeft': socket.emit('move', 'left'); break;
          case 'ArrowRight': socket.emit('move', 'right'); break;
          case ' ': socket.emit('fire'); break;
        }
      }
    });

    // 加入游戏
    const playerName = prompt('请输入你的名字 (最多10个字符):', 'Player' + Math.floor(Math.random()*100));
    if (playerName) {
      socket.emit('joinGame', { name: playerName.substring(0, 10) });
    } else {
      socket.emit('joinGame', { name: 'Anonymous' });
    }

    // 每帧更新画面
    setInterval(drawPlayers, 100);
  </script>
</body>
</html>
